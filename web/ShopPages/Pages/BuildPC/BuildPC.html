<!DOCTYPE html>
<html lang="en">
    <head >
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>Build PC | CyberBeast</title>

        <link href="/ComputerOnlineShop/ShopPages/Pages/css/bootstrap.min.css" rel="stylesheet">
        <link href="/ComputerOnlineShop/ShopPages/Pages/css/font-awesome.min.css" rel="stylesheet">
        <link href="/ComputerOnlineShop/ShopPages/Pages/css/prettyPhoto.css" rel="stylesheet">
        <link href="/ComputerOnlineShop/ShopPages/Pages/css/price-range.css" rel="stylesheet">
        <link href="/ComputerOnlineShop/ShopPages/Pages/css/animate.css" rel="stylesheet">
        <link href="/ComputerOnlineShop/ShopPages/Pages/css/main.css" rel="stylesheet">
        <link href="/ComputerOnlineShop/ShopPages/Pages/css/responsive.css" rel="stylesheet">

        <!--[if lt IE 9]>
        <script src="/ComputerOnlineShop/ShopPages/Pages/js/html5shiv.js"></script>
        <script src="/ComputerOnlineShop/ShopPages/Pages/js/respond.min.js"></script>
        <![endif]-->

        <link rel="shortcut icon" href="/ComputerOnlineShop/ShopPages/Pages/images/ico/favicon.ico">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/ComputerOnlineShop/ShopPages/Pages/images/ico/apple-touch-icon-144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/ComputerOnlineShop/ShopPages/Pages/images/ico/apple-touch-icon-114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/ComputerOnlineShop/ShopPages/Pages/images/ico/apple-touch-icon-72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="/ComputerOnlineShop/ShopPages/Pages/images/ico/apple-touch-icon-57-precomposed.png">
        <style>
            .component-block {
                border: 1px solid #ccc;
                border-radius: 8px;
                margin-bottom: 20px;
                padding: 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .component-image {
                width: 80px;
                height: 80px;
                object-fit: cover;
                margin-right: 15px;
            }
            .modal-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 9999;
                justify-content: center;
                align-items: center;
            }
            .modal-content {
                background: white;
                padding: 20px;
                border-radius: 8px;
                width: 80%;
                max-width: 800px;
            }
            .close-btn {
                float: right;
                cursor: pointer;
                font-weight: bold;
            }
        </style>
    </head>
    <body><!-- comment -->
        <header id="header">
            <div class="header_top">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="contactinfo">
                                <ul class="nav nav-pills">
                                    <li><a href="#"><i class="fa fa-phone"></i> 0337593524</a></li>
                                    <li><a href="#"><i class="fa fa-envelope"></i> CyberBeast@gmail.com</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="social-icons pull-right">
                                <ul class="nav navbar-nav">
                                    <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                                    <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                                    <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
                                    <li><a href="#"><i class="fa fa-dribbble"></i></a></li>
                                    <li><a href="#"><i class="fa fa-google-plus"></i></a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="header-middle">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="logo pull-left">
                                <a href="/ComputerOnlineShop/HomePages">
                                    <img src="/ComputerOnlineShop/ShopPages/Pages/images/home/CyberBeast2.png" style="height: 150px; width: 200px;" />
                                </a>
                            </div>
                        </div>
                        <div class="col-sm-8">
                            <div class="shop-menu pull-right">
                                <ul class="nav navbar-nav" style="padding-top: 50px">
                                    <!-- Static for HTML, no session check -->
                                    <li><a href="http://localhost:8080/ComputerOnlineShop/Login"><i class="fa fa-lock"></i> Login</a></li>
                                    <li><a href="http://localhost:8080/ComputerOnlineShop/SignUp"><i class="fa fa-user-plus"></i> Sign Up</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="header-bottom">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-9">
                            <div class="navbar-header">
                                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                                    <span class="sr-only">Toggle navigation</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                            </div>
                            <div class="mainmenu pull-left">
                                <ul class="nav navbar-nav collapse navbar-collapse">
                                    <li><a href="/ComputerOnlineShop/HomePages" class="">Home</a></li>
                                    <li><a href="/ComputerOnlineShop/CategoriesController?service=list" class="">Products</a></li>
                                    <li><a href="/ComputerOnlineShop/blogc" class="">Blog</a></li>
                                    <li><a href="404.html" class="">404</a></li>
                                    <li><a href="contact-us.html" class="">Contact</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="search_box pull-right">
                            <form action="/ComputerOnlineShop/CategoriesController" method="get" style="display: flex;">
                                <input type="hidden" name="service" value="filter" />
                                <input type="text" name="keyword" class="form-control" placeholder="Insert name product" style="width: 180px;" />
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </header>


        <h1 class="text-center">Build Your PC</h1>
        <div class="container">
            <div class="row">
                <div class="col-md-7">
                    <!--MainBoard -->
                    <div class="component-block" id="component-2">
                        <div class="d-flex align-items-center">
                            <img id="img-2" src="/ComputerOnlineShop/ShopPages/Pages/images/anhproduct/2.jpg"
                                 data-default="/ComputerOnlineShop/ShopPages/Pages/images/anhproduct/2.jpg"
                                 alt="MainBoard" class="component-image">
                            <div>
                                <strong>MainBoard</strong>
                                <div id="meta-2" class="component-meta"></div>
                                <div id="price-2" class="component-price"></div>
                                <button id="remove-2" class="btn btn-sm btn-danger mt-2" style="display:none;" onclick="removeComponent(2)">Remove</button>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="openModal(2, 'MainBoard')">Choose</button>
                    </div>
                    <!--CPU -->
                    <div class="component-block" id="component-3">
                        <div class="d-flex align-items-center">
                            <img id="img-3" src="/ComputerOnlineShop/ShopPages/Pages/images/anhproduct/2.jpg"
                                 data-default="/ComputerOnlineShop/ShopPages/Pages/images/anhproduct/2.jpg"
                                 alt="MainBoard" class="component-image">
                            <div>
                                <strong>CPU</strong>
                                <div id="meta-3" class="component-meta"></div>
                                <div id="price-3" class="component-price"></div>
                                <button id="remove-3" class="btn btn-sm btn-danger mt-3" style="display:none;" onclick="removeComponent(3)">Remove</button>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="openModal(3, 'CPU')">Choose</button>
                    </div>
                    <!--GPU -->
                    <div class="component-block" id="component-4">
                        <div class="d-flex align-items-center">
                            <img id="img-4" src="/ComputerOnlineShop/ShopPages/Pages/images/anhproduct/2.jpg"
                                 data-default="/ComputerOnlineShop/ShopPages/Pages/images/anhproduct/2.jpg"
                                 alt="MainBoard" class="component-image">
                            <div>
                                <strong>GPU</strong>
                                <div id="meta-4" class="component-meta"></div>
                                <div id="price-4" class="component-price"></div>
                                <button id="remove-4" class="btn btn-sm btn-danger mt-4" style="display:none;" onclick="removeComponent(4)">Remove</button>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="openModal(4, 'GPU')">Choose</button>
                    </div>
                    <!--RAM --> 
                    <div class="component-block" id="component-5">
                        <div class="d-flex align-items-center">
                            <img id="img-5" src="/ComputerOnlineShop/ShopPages/Pages/images/anhproduct/2.jpg"
                                 data-default="/ComputerOnlineShop/ShopPages/Pages/images/anhproduct/2.jpg"
                                 alt="MainBoard" class="component-image">
                            <div>
                                <strong>RAM</strong>
                                <div id="meta-5" class="component-meta"></div>
                                <div id="price-5" class="component-price"></div>
                                <button id="remove-5" class="btn btn-sm btn-danger mt-5" style="display:none;" onclick="removeComponent(5)">Remove</button>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="openModal(5, 'RAM')">Choose</button>
                    </div>
                    <!--SSD--> 
                    <div class="component-block" id="component-6">
                        <div class="d-flex align-items-center">
                            <img id="img-6" src="/ComputerOnlineShop/ShopPages/Pages/images/anhproduct/2.jpg"
                                 data-default="/ComputerOnlineShop/ShopPages/Pages/images/anhproduct/2.jpg"
                                 alt="MainBoard" class="component-image">
                            <div>
                                <strong>SSD</strong>
                                <div id="meta-6" class="component-meta"></div>
                                <div id="price-6" class="component-price"></div>
                                <button id="remove-6" class="btn btn-sm btn-danger mt-6" style="display:none;" onclick="removeComponent(6)">Remove</button>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="openModal(6, 'SSD')">Choose</button>
                    </div>
                    <!--Case--> 
                    <div class="component-block" id="component-7">
                        <div class="d-flex align-items-center">
                            <img id="img-7" src="/ComputerOnlineShop/ShopPages/Pages/images/anhproduct/2.jpg"
                                 data-default="/ComputerOnlineShop/ShopPages/Pages/images/anhproduct/2.jpg"
                                 alt="MainBoard" class="component-image">
                            <div>
                                <strong>Case</strong>
                                <div id="meta-7" class="component-meta"></div>
                                <div id="price-7" class="component-price"></div>
                                <button id="remove-7" class="btn btn-sm btn-danger mt-7" style="display:none;" onclick="removeComponent(7)">Remove</button>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="openModal(7, 'Case')">Choose</button>
                    </div>

                    <!--Open modal--> 
                    <div class="modal-overlay" id="customModal">
                        <div class="modal-content">
                            <span class="close-btn" id="closeModal">&times;</span>
                            <h4 id="modalTitle">Select Component</h4>
                            <div id="modalBody">Loading...</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border p-3 mt-3">
                        <h4 class="text-center mb-3" style="">Tổng tiền</h4>
                        <h3 class="text-center text-success"><span id="totalPrice">0</span>₫</h3>
                    </div>
                </div>

            </div>
        </div>
    </body>
    <script>
        const ctx = "/ComputerOnlineShop";
    </script>
    <script>
        const modal = document.getElementById('customModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const totalDisplay = document.getElementById('totalPrice');
        const selectedComponents = {};
// open model
        function openModal(componentID, componentName) {
            modal.style.display = 'flex';
            modalTitle.innerText = `Select ${componentName}`;
            modalBody.innerHTML = "<p>Loading...</p>";

            fetch(`/ComputerOnlineShop/BuildPC?service=filter&componentID=${componentID}&ajax=true`)
                    .then(res => res.text())
                    .then(html => {
                        modalBody.innerHTML = html;
                        attachFilterFormHandler(componentID, componentName);
                        attachPaginationHandler(componentID, componentName);
                    })
                    .catch(err => {
                        modalBody.innerHTML = "<p style='color:red;'>Failed to load data</p>";
                    });
        }
        // make model not close
        function attachFilterFormHandler(componentID, componentName) {
            const filterForm = modalBody.querySelector('#filterForm');
            if (filterForm) {
                filterForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    const url = filterForm.action + '?' + new URLSearchParams(new FormData(filterForm)).toString();

                    fetch(url)
                            .then(res => res.text())
                            .then(innerHtml => {
                                modalBody.innerHTML = innerHtml;
                                attachFilterFormHandler(componentID, componentName);
                                attachPaginationHandler(componentID, componentName);
                            });
                });
            }
        }

        document.getElementById('closeModal').addEventListener('click', () => {
            modal.style.display = 'none';
        });





        function restoreSelections() {
            const stored = localStorage.getItem("selectedComponents");
            if (stored) {
                Object.assign(selectedComponents, JSON.parse(stored));
                for (let key in selectedComponents) {
                    const data = selectedComponents[key];
                    document.getElementById(`meta-${key}`).innerText = `${data.categoryName} - ${data.brandName}`;
                    document.getElementById(`price-${key}`).innerText = `${data.price.toLocaleString()}₫`;
                    document.getElementById(`remove-${key}`).style.display = 'inline-block';
                    // ✅ Khôi phục ảnh
                    const img = document.querySelector(`#component-${key} img`);
                    if (img && data.imageURL) {
                        img.src = ctx + "/ShopPages/Pages/images/anhproduct/" + data.imageURL;
                    }
                }
                updateTotal();
            }
        }
        window.addEventListener('load', restoreSelections);

// Update money
        function updateTotal() {
            let total = 0;
            for (let key in selectedComponents) {
                total += selectedComponents[key].price;
            }
            totalDisplay.innerText = total.toLocaleString();
        }
    </script>
    <script>
        // Take Data form chose catgegory
        function selectProduct(componentID, categoryName, brandName, price, imgURL) {
            document.getElementById(`meta-${componentID}`).innerText = `${categoryName} - ${brandName}`;
            document.getElementById(`price-${componentID}`).innerText = `${price.toLocaleString()}₫`;
            document.getElementById(`remove-${componentID}`).style.display = 'inline-block';

            const image = document.getElementById(`img-${componentID}`);
            if (image) {
                image.src = `${ctx}/ShopPages/Pages/images/anhproduct/${imgURL}`;
            }

            selectedComponents[componentID] = {
                categoryName: categoryName,
                brandName: brandName,
                price: price,
                imgURL: imgURL
            };
            localStorage.setItem("selectedComponents", JSON.stringify(selectedComponents));
            updateTotal();
            modal.style.display = 'none';
        }

// Delete Component
        function removeComponent(componentID) {
            const confirmDelete = confirm("Are you sure you want to remove this component?");
            if (!confirmDelete)
                return;

            delete selectedComponents[componentID];
            localStorage.setItem("selectedComponents", JSON.stringify(selectedComponents));

            document.getElementById(`meta-${componentID}`).innerText = "";
            document.getElementById(`price-${componentID}`).innerText = "";
            document.getElementById(`remove-${componentID}`).style.display = 'none';

            // auto resert
            const img = document.getElementById(`img-${componentID}`);
            img.src = img.getAttribute("data-default");

            updateTotal();
        }



    </script>
    <!--Select Pages-->
    <script>
        function goToPage(page, componentID, componentName) {
            const filterForm = modalBody.querySelector('#filterForm');
            if (filterForm) {
                const formData = new FormData(filterForm);
                formData.set("page", page);
                const queryString = new URLSearchParams(formData).toString();
                const url = filterForm.action + "?" + queryString;

                modalBody.innerHTML = "<p>Loading...</p>";
                fetch(url)
                        .then(res => res.text())
                        .then(html => {
                            modalBody.innerHTML = html;
                            attachFilterFormHandler(componentID, componentName);
                            attachPaginationHandler(componentID, componentName); // Gắn lại pagination
                            modalBody.scrollTop = 0;
                        });
            }
        }
            function attachPaginationHandler(componentID, componentName) {
            modalBody.querySelectorAll(".page-link").forEach(link => {
                link.addEventListener("click", function (e) {
                    e.preventDefault();
                    const page = parseInt(this.textContent.trim());
                    if (!isNaN(page)) {
                        goToPage(page, componentID, componentName);
                    }
                });
            });
        }
    </script>
</body>

</html>
